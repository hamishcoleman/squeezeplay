os: linux
dist: bionic
language: c

install:
    - sudo apt-get -y install libogg-dev libasound-dev dpkg-dev fakeroot

# The output of the tolua++ program has been committed to version control,
# so try and force using it (the tolua++ program is not installed in the build
# environment)
before_script:
    - touch src/squeezeplay/src/ui/lua_jiveui.c

script:
    - make -C src/ -f Makefile.linux
    - make -C src/squeezeplay squeezeplay-deb

deploy:
    provider: releases
    token: "$GITHUB_TOKEN"
    skip_cleanup: true
    prerelease: true
    overwrite: true
    on:
        tags: true
    file_glob: true
    file:
        - ../build/*.tgz
        - src/*.deb
